const catalogo = {
    branca: {
        nome: "Faixa Branca",
        chutes: [
            { num: "01", cantones: "Dan Toi", portugues: "Frontal perna de tr√°s", videoId: "1pCcrKE51Qa7Fhr4SE2PhqQ0M67rJG9DF" },
            { num: "02", cantones: "Baan Toi", portugues: "Peito do p√© perna de tr√°s", videoId: "1ewFRPKGRv3_csnu-06g1AGUykTstMaXf" },
            { num: "03", cantones: "Chang Toi", portugues: "Faca do p√© perna de tr√°s", videoId: "1cIsIaGy7QcQ7OQTb3tk4Ag3ANW6f-KDT" },
            { num: "04", cantones: "Dan Toi", portugues: "Frontal perna da frente", videoId: "1iodexDdnlkivIPOl7HmCM_MO7tKYP3G3" },
            { num: "05", cantones: "Baan Toi", portugues: "Peito do p√© perna da frente", videoId: "17jbvy5ZMQot_LJlSLgIWeRJ7S5WAGkr3" },
            { num: "06", cantones: "Chang Toi", portugues: "Faca do p√© perna da frente", videoId: "1TS5hNWNojpst2J-wPRvoFSuo2uwGkrzy" }
        ],
        basicos: [
            { num: "01", cantones: "Jik Choy", portugues: "", videoId: "1d7oGmgzMVC4PfCPKQT_Pa7JwvD1nhJsh" },
            { num: "02", cantones: "Chin Lah", portugues: "", videoId: "10dSGyQP0ysiE0UfiuNn7M09xhWNqWDxJ" },
            { num: "03", cantones: "Chum Cue", portugues: "", videoId: "1Tmxn0dFbeJ6bzCRID0wlfRknUSEaP1DT" },
            { num: "04", cantones: "Cum Jern", portugues: "", videoId: "12Q6U8Gr2w0Y3KuWCx8sVB6uSyXHd4Ijm" },
            { num: "05", cantones: "Pow Jern", portugues: "", videoId: "1ZUcr5rtC1_6h1WbDYf1flj6DMVNmUvrG" },
            { num: "06", cantones: "Yeung Chop Choy", portugues: "", videoId: "1Du9JfZaaTIOWDor3tfa8q4gTZAnoQ6BW" },
            { num: "07", cantones: "Yum Chop Choy", portugues: "", videoId: "1XjOgQr2q3n0-XAm05lBGYqNzMyIjf9in" },
            { num: "08", cantones: "Cheung Ahn Choy", portugues: "", videoId: "1n7DF7SlxrNmUSieXJXZL-us4Bh9TXnUH" },
            { num: "09", cantones: "Gwa Choy", portugues: "", videoId: "1OfoDGDwDJ9qv0zhn-nLkFPneGhea0iZQ" },
            { num: "10", cantones: "Biu Jong Choy", portugues: "", videoId: "12Vn0zbvdwahrbu2U8s20GerVndyV3luE" }
        ],
        taolus: [
            { cantones: "Gay Boon Kyun Yet", portugues: "Forma b√°sica de m√£o n√∫mero 1", videoId: "1i1ZwBExFmTEkZUykKi_ROAPkp9QIytbE" },
            { cantones: "Gay Boon Ma Bo Yet", portugues: "Forma b√°sica de postura n√∫mero 1", videoId: "1OMU85v-Rpufn-jrll8zP4IX2F-qAI4Jy" }
        ]
    },
    amarela: {
        nome: "Faixa Amarela",
        chutes: [
            {
                num: "01",
                cantones: "LoÃÑi Bai Leen Toi",
                portugues: "Batendo na M√£o",
                videoId: "1S4FjotZLvj90tSWmD8MbBrDaktVvSu9p"
            },
            {
                num: "02",
                cantones: "Tin Toi",
                portugues: "Perna da Frente",
                videoId: "1M57iZX-OrZgcY_idQnKayMcAvFmQiipd"
            },
            {
                num: "03",
                cantones: "Tin Toi",
                portugues: "Perna de Tr√°s",
                videoId: "1Bff9nf8AEiCWNJc6ac5E_nfJnyMBahZW"
            },
            {
                num: "04",
                cantones: "Jaat Hay Dan Toi",
                portugues: "Sobrepasso",
                videoId: "10DdlH-bN_oSoibtdJH17OjBWt2MiUgQT"
            },
            {
                num: "05",
                cantones: "Jaat Hay Baan Toi",
                portugues: "Sobrepasso",
                videoId: "1zpHFMMCpzKBerJw-4ea435jPHIaLfcEv"
            },
            {
                num: "06",
                cantones: "Jaat Hay Chang Toi",
                portugues: "Sobrepasso",
                videoId: "1uaNOkvaH3QkLRMJ30kSxeR6QJcWXEmVw"
            }
        ],
        basicos: [
            { num: "01", cantones: "Fu Jow", videoId: "1IiPlyJPJdvRIM16roaNJPt3Yqc1bDhm0" },
            { num: "02", cantones: "Choy Lahp", videoId: "1RFutwHDYtv4TevCHaNVMix39rPVmA_IP" },
            { num: "03", cantones: "Yum Jern", videoId: "1Y6eFtGhr7A17TeFEOmPGAkUXJpXIhLFO" },
            { num: "04", cantones: "Fahn Jong Choy", videoId: "1_Ustox4czjPmtvXimba_ogzNtgGBGI3q" },
            { num: "05", cantones: "Cup Choy", videoId: "1Dq0GLfezPz03fWr5CHqUhKlxYZaU0jpw" },
            { num: "06", cantones: "Poon Kue Sow Choy", videoId: "1ff6Xc7_OtSu50yjvTae--J9QXsiaxGMP" },
            { num: "07", cantones: "Gwa Choy Cum Jern", videoId: "1l2sjKLPsrEhYJyiPEu5NNKoJeM21BFrl" },
            { num: "08", cantones: "Gwa Choy Pow Choy", videoId: "1bILRi5dZfjydi3_y7L8BZPk0yB8W3pqh" },
            { num: "09", cantones: "Been Choy", videoId: "1pm4MfsR0eL4Gv2eNNiN-c05YBKMN5UDB" },
            { num: "10", cantones: "Loong Kue", videoId: "1b6SbRLDRHx-fRxmn1Mr-N3RmSq0chylN" }
        ],
        taolus: [
            { cantones: "Gay Boon Kyun Yee", videoId: "1CxV0z6PtNfQg5L6gXI8lrRvsfJouMXmU" },
            { cantones: "Gay Boon Ma Bo Yee", videoId: "17qlphhCq7w1d01XVCk5Dz3aIvtJ5EGSo" }
        ]
    },
    laranja: {
        nome: "Faixa Laranja",
        chutes: [
            { num: "01", cantones: "Loi Bai Pek Gwaa Toi", portugues: "Pisando o p√© a frente de fora para dentro", videoId: "16mvrLrf0gmkVAsWqyL_GbnH3Fru24S2I" },
            { num: "02", cantones: "Oi Bai Pek Gwaa Toi", portugues: "Pisando o p√© a frente de dentro para fora", videoId: "1OXFzUdrItdP6pOjoTNEHhGVaSozH7vfg" },
            { num: "03", cantones: "Seung Dan Toi", portugues: "Frontal duplo", videoId: "1TZV8LBAMgV-euRPoT_Dqs4YcLt459EZj" },
            { num: "04", cantones: "Seung Baan Toi", portugues: "Peito do p√© duplo", videoId: "12lV5TgkCh84uAUSj2xM0Ue3KUiLlopSu" },
            { num: "05", cantones: "Seung Chang Toi", portugues: "Faca do p√© duplo", videoId: "1jKm3bD6r5SqSAK30jT8tU6YI56k_ER5a" }
        ],
        basicos: [
            { num: "01", cantones: "Kwan Sao", videoId: "1Dl2rz6xqVtWdGpkCB3EAQq1yrgIAutT8" },
            { num: "02", cantones: "Kong Jerng", videoId: "1Fg_96B0lSH344ntI8yUCJLwqz70SDeqC" },
            { num: "03", cantones: "Gong Jerng", videoId: "1We471FlYx9QGwsXeHwLRaosZAC3L6kI_" },
            { num: "04", cantones: "Chin Lah / Dahn Lah", videoId: "1JXiOLu9BK233IJrC4FzKSRa-xfNSg_77" },
            { num: "05", cantones: "Pak Sao / Yam Kiu", videoId: "1uU4BQnzFbi_WR3DNzZcoC9Msq3DgcJdm" },
            { num: "06", cantones: "Cum Jerng / Gout Sao", videoId: "17oUUSofI6BeGEEoLsI7qAjvB6NFUadRU" },
            { num: "07", cantones: "Gwa / Pao / Gwa / Sao", videoId: "1Q0pOV0juQ650ojpfUv9wmUqUO4_6TwkX" },
            { num: "08", cantones: "Tsin Choy", videoId: "1655k7mGlsVUtlN2m2AB7FnjxN8hL2kVM" },
            { num: "09", cantones: "Pie Jah / Big Jah / Pow Jah / Chong Jah", videoId: "1Khldu2MaQfb3OzZmGpb9GO_uCoVk7x0b" },
            { num: "10", cantones: "Wang Deng Choy", videoId: "1wDzRJvZ3LVazmt9YidIFy3VfE3sK7nAq" }
        ],
        basicos_complementares: [
            { num: "01", cantones: "Gwa choy - Cum Jern - Poon Kue - Chi sin choy - Biu jong", videoId: "1TGKHQDhdTRccG03D8Q5cn0fSJpDOwSDh" },
            { num: "02", cantones: "Chin lah - Poon kue - Cum jern - Chop choy", videoId: "1UjyGVKKO4ILaeZsi3hDxz6Sx-xh0jpVc" },
            { num: "03", cantones: "Chin lah - Poon kue - Serng choy lahp", videoId: "1RqLYtXtmjqVAC7vrF4J0_NKRdLNWQFhW" },
            { num: "04", cantones: "Fu jow - Fu hay - Pak Girk - Yut Lahp - Joi lahp - Cheung ahn choy", videoId: "1NK4uepk9CKG6mzTFxlkaU3i2KOHNbdcQ" }
        ],
        taolus: [
            { cantones: "Ng Lun Kyun (Var. 1)", videoId: "1oroM0dj3xkVEuY65MPQjD-LL172D-5Jj" },
            { cantones: "Ng Lun Kyun (Var. 2)", videoId: "1cTvDuLAnRQLglfEm-iL1rBBXN-gbOqUx" },
            { cantones: "Ng Lun Kyun (Var. 3)", videoId: "14eVCJqj_wdKHXbzMUs9J4XnK7xRrd7Ar" },
            { cantones: "Gay Boon Kyun Saam", portugues: "Forma b√°sica de m√£o n√∫mero 3", videoId: "1vKMxFs5s3KJtscvkYLDw7dvZSnT2Fw9c" }
        ]
    },
    jade: {
        nome: "Faixa Jade",
        chutes: [
            { num: "01", cantones: "Chute em curva", portugues: "", videoId: "1G8TiRtZ-DPSGSk3sgq0v3K2wWmKA11Ck" },
            { num: "02", cantones: "Chute em curva", portugues: "p√© da frente", videoId: "17Oa-xxPRpm6oUP-YpA5efQz38GUT5FIO" },
            { num: "03", cantones: "Wah soh toi", portugues: "gancho", videoId: "1biJiqIeoELezUrpRu4yKWCyoEitpodIz" },
            { num: "04", cantones: "Jaat hay wah soh toi", portugues: "sobrepasso gancho", videoId: "1M_KHCseR8MqGSwPOLYHZgCJC2apr_4-z" },
            { num: "05", cantones: "Juen sun chang toi", portugues: "faca do p√© pelas costas", videoId: "1po2mg--RZyi0o3e8_rbd0JNVIUiHzM93" },
            { num: "06", cantones: "Passo juen sun chang toi", portugues: "passo faca do p√© pelas costas", videoId: "1taKXTR-f-gMI1VYh79JY7hlVMapInpTC" }
        ],
        basicos: [
            { num: "01", cantones: "Mahn Kwun", videoId: "1q1vTqeZg5a3Ui-zC0DxzRLMysgdxX2PK" },
            { num: "02", cantones: "Liu Kwun", videoId: "1VUv88lpRTTw-rn3hYzWogbu_c1HS-sl3" },
            { num: "03", cantones: "Pah Kwun - Lah kwun", videoId: "1oaXMNbVxNgIxD-bWn6qJYqLrH5_giZi-" },
            { num: "04", cantones: "Low soi kwun", videoId: "1sBhP-tsrbt0bUEAn49a6x-lJo8PPl7wJ" },
            { num: "05", cantones: "How kwun", videoId: "1rd_E4istjrsanbXCjEjiiyMK9K7UKmoF" },
            { num: "06", cantones: "Da kwun", videoId: "1oBw02HoZZqJgLVP-4kTPtnEnOW_xkyG7" },
            { num: "07", cantones: "Jeet Kwun", videoId: "1A3oNa2Gxc6htJ7WuLaBlzgRtzGtG-n6s" },
            { num: "08", cantones: "Wang da kwun", videoId: "1BpVfdAUjFQkZYh3Fhkb7Cg8IK5zrUER7" },
            { num: "09", cantones: "Ping Kwun", videoId: "1JbcuXyrGVEpMGG6fcO2AlnTVAekkstiG" },
            { num: "10", cantones: "So ho kwun", videoId: "1GhpQTyGsuU01A7oTZSr0UVlwC5m0vT36" }
        ],
        basicos_complementares: [
            { num: "01", cantones: "Low soi kwun - da kwun - jeet kwun", videoId: "1oU5TBuw8_JBdFDj2Z_fcCbIJ3rJERZnX" },
            { num: "02", cantones: "Mahn kwun - low ma - tic kwun", videoId: "1CcTwoeEhAVElJNW1OPn2BQLNH-IGAJet" },
            { num: "03", cantones: "Pah kwun - lap kwun - so ho kwun", videoId: "1e5-zeV92SgY4--gMRp-opYbpy8DMeNt2" }
        ],
        taolus: [
            { cantones: "Sil Lum Kwun", portugues: "Bast√£o Shaolin", videoId: "1eY_KQRSd2-b-O5devzeWr_m0peofLX3L" }
        ]
    },
    verde: {
        nome: "Faixa Verde",
        chutes: [
            { num: "01", cantones: "Dan Toi", portugues: "Frontal empurrando", videoId: "1NliPEC6svW6ELPr6K4W5q-iq3Q33HiVg" },
            { num: "02", cantones: "Baan toi + Chang toi", portugues: "peito do p√© + faca do p√© com a mesma perna", videoId: "1ChlxLWr0NcYC-Dg91Mfh9xRsOFFfq86z" },
            { num: "03", cantones: "Soh girk", portugues: "rasteira frontal", videoId: "1k1S286wF0CQjEkGKk4ptImONkMSR0GuA" },
            { num: "04", cantones: "Baan toi juen sun", portugues: "360¬∫ peito do p√©", videoId: "1309FGMq0aUM8GPa66zNbP_Zy1HmVaQj2" },
            { num: "05", cantones: "Juen sun wang soh toi", portugues: "reverso", videoId: "1ng6JIYbs0vkxGdm62q3s3ZMmHdAB8hDl" },
            { num: "06", cantones: "Passo juen sun wang soh toi", portugues: "passo + reverso", videoId: "1LtUqQtnRKKDoKnz_vKARIQ6uIUYDkm80" }
        ],
        basicos: [
            { num: "01", cantones: "Jaat haay - Chong fu", videoId: "1SSy5MPuuCzU4RZ4OIZjp6XTWtaFQuBQb" },
            { num: "02", cantones: "Chin lah - yum chop choy- tek girk - po choy", videoId: "1D0t91NpD-mhQA1UXLQmECqpBtnLlicfY" },
            { num: "03", cantones: "Chin lah - sern poon kue - soh girk", videoId: "1O-lcE0EheLqepv_VQZV6a04_9VNhQu0U" },
            { num: "04", cantones: "Gwa choy - gong jern - pie jahng - loon kue", videoId: "1l4OqnOumQkRU_bfPeciJFC2yf14889fS" },
            { num: "05", cantones: "Gong jern (3x) - fahn jong choy", videoId: "1YqFGFzJTBknrp2MZbPVKKguSBA8lOzYm" },
            { num: "06", cantones: "Fahn jong choy - poon kue - kwan sao", videoId: "1pFmXZzJAhjht16xFO-r0IR7rYa7kCQFJ" }
        ],
        taolus: [
            { cantones: "Siu Mui Fah Kyun", videoId: "17-poxSYGw3W6tiTBJ0KGcnYnVCENW6D2" }
        ]
    },
    roxa: {
        nome: "Faixa Roxa",
        chutes: [
            { num: "01", cantones: "Hou sou toi", portugues: "rasteira 360¬∫ por tr√°s", videoId: "1gtmee8lApfPfXhxk18vbKI33MWdFOKjR" },
            { num: "02", cantones: "Baan toi + Juen sun chang toi", portugues: "peito do p√© + faca do p√© pelas costas", videoId: "12QsgbyAv9iB5v_xZJy1VgD79Dsu4xZhN" },
            { num: "03", cantones: "Passo jaat hay dan toi", videoId: "1Gua-B42q8esr8oPaaYiqGYtOh4FLpcEd" },
            { num: "04", cantones: "Passo jaat hay baan toi", videoId: "1nsrurWWBYBl4HxLPgRd5iPryXRTmdYQP" },
            { num: "05", cantones: "Passo jaat hay chang toi", videoId: "1uO5WT8tA_Cy-tcFSfCHuVFh2-5elgZDv" }
        ],
        basicos: [
            { num: "01", cantones: "B√°sico", videoId: "1cF8m0Goi-QnWNPoIhaix8JprWmgrGZbz" },
            { num: "02", cantones: "B√°sico", videoId: "1YFzDYpfAMeCRekphbhejXTvQWqTBMcfe" },
            { num: "03", cantones: "B√°sico", videoId: "1TY0uhKUJMYKjDNSNplU2zwiSZ3NbgalW" },
            { num: "04", cantones: "B√°sico", videoId: "1bku9_Zm1gkX9Nr738hCGs9Q4SlpB7gpt" },
            { num: "05", cantones: "B√°sico", videoId: "1OvnGwOjdfuPw2jXhohQVCrPuIXXGzXiU" }
        ],
        taolus: [
            { cantones: "Mui Fah Bin Gwai Kwun", videoId: "1bAmoJcsTlAjbIy7rc4HBgKoqgs_V8crV" },
            { cantones: "Ng Lun Ma", videoId: "10g66RWyygomS_-_NcKvoJoCOwf-VRFma" }
        ]
    },
    vermelha: {
        nome: "Faixa Vermelha",
        chutes: [
            { num: "01", cantones: "Passo Chute em Curva Saltando", videoId: "1JiqTp1f4YVI4vFAZslUhplbmkaK4uBdw" },
            { num: "02", cantones: "Furac√£o Batendo na M√£o", videoId: "1bVRsXGO7KOBvQh3jGPgLe8sWIFrwJXx6" },
            { num: "03", cantones: "Furac√£o com Peito do P√©", videoId: "1zJ3uFzMZBBmysoNBQjTu5Min__7qtgZ3" },
            { num: "04", cantones: "Facada do P√© por Tr√°s Saltando", videoId: "1sl4oSMCPeB9jS_33cSdR3arxY17Vjfs7" },
            { num: "05", cantones: "Passo Facada do P√© por Tr√°s Saltando", videoId: "1UoRwu4t37UzlXIq1ACICLOOwCC3Ji0NS" }
        ],
        basicos: [
            { num: "01", cantones: "B√°sico (Outro √Çngulo)", videoId: "1PJkZiDZC659gzFF8tKiD7NjCK-zIpPF0" },
            { num: "01", cantones: "B√°sico", videoId: "1xuTPVEXm5J2_WtFb_KY-rGWTzCkhMU0r" },
            { num: "02", cantones: "B√°sico", videoId: "1ibHjZmIL6dPMTeVdMRx2qbYieOlXsV1L" },
            { num: "03", cantones: "B√°sico", videoId: "1KIES1Zl2HXya3yNX-ziJhnkTVyC9VDKG" },
            { num: "04", cantones: "B√°sico", videoId: "19l_pVAZI_W7l4boe0C7Rh_88eGBi7YfW" },
            { num: "05", cantones: "B√°sico", videoId: "1eQYJYkCtfBU1w2Qfyan1bOuSZgONGrGH" }
        ],
        taolus: [
            { cantones: "Ching Jong", videoId: "1QbB2gZQ-PuJQFhkpASY_JIacBwaM8UZc" },
            { cantones: "Tut Tsen Kyun", videoId: "1CgYit_gKECt0xXOERqZ6NKpe_3YG0i2d" }
        ]
    },
    marrom_claro: { nome: "Faixa Marrom Claro", chutes: [], basicos: [], taolus: [] },
    marrom_escuro: { nome: "Faixa Marrom Escuro", chutes: [], basicos: [], taolus: [] },
    preta: { nome: "Faixa Preta", chutes: [], basicos: [], taolus: [] }
};

// Elementos da Interface
const viewHome = document.getElementById("view-home");
const viewFaixa = document.getElementById("view-faixa"); // Container da faixa
const videoModal = document.getElementById("video-modal");
const videoIframe = document.getElementById("video-iframe");
const modalTitle = document.getElementById("modal-title");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");

let currentPlaylist = [];
let currentIndex = 0;

// Inicializa√ß√£o: Renderiza a Home est√°tica
function init() {
    renderHome();
}

function renderHome() {
    viewHome.innerHTML = `
    <div class="grid">
      ${Object.keys(catalogo).map(id => {
        const f = catalogo[id];
        const temVideo = f.chutes.length > 0 || f.basicos.length > 0 || f.taolus.length > 0;
        const classe = temVideo ? `card faixa-${id}` : `card disabled faixa-${id}`;
        // Agora chamamos showFaixa em vez de recarregar tudo
        const clique = temVideo ? `onclick="showFaixa('${id}')"` : "";
        return `<div class="${classe}" ${clique}>
                  <div class="card-content">${f.nome}</div>
                </div>`;
    }).join("")}
    </div>
  `;
}

// Navega√ß√£o: Mostra Tela da Faixa (esconde Home)
function showFaixa(id) {
    const f = catalogo[id];

    // Renderiza o conte√∫do da faixa dinamicamente no container #view-faixa
    viewFaixa.innerHTML = `
    <div class="back" onclick="closeFaixa()">‚Üê Voltar</div>
    <h2>${f.nome}</h2>

    ${categoria("Chutes", f.chutes, id, 'chutes')}
    ${categoria("B√°sicos", f.basicos, id, 'basicos')}
    ${f.basicos_complementares ? categoria("B√°sicos Complementares", f.basicos_complementares, id, 'basicos_complementares') : ""}
    ${categoria("Taolu¬¥s", f.taolus, id, 'taolus')}
  `;

    // Troca de Visibilidade
    viewHome.classList.add("hidden");
    viewFaixa.classList.remove("hidden");

    // Rola para o topo da faixa (opcional, mas bom pra UX ao entrar)
    window.scrollTo(0, 0);
}

// Navega√ß√£o: Volta para Home (esconde Faixa)
function closeFaixa() {
    viewFaixa.classList.add("hidden");
    viewHome.classList.remove("hidden");
    // N√£o precisa rolar, o browser lembra a posi√ß√£o da Home
}


function categoria(nome, videos, faixaId, catKey) {
    if (!videos || videos.length === 0) {
        return `
      <div class="section">
        <h3>${nome}</h3>
        <div class="empty-state">üé• Em breve: Conte√∫do em prepara√ß√£o...</div>
      </div>
    `;
    }

    return `
    <div class="section">
      <h3>${nome}</h3>
      <div class="row">
        ${videos.map((v, index) => {
        // L√≥gica H√≠brida: Suporta formato antigo (titulo) e novo (cantones + portugues)
        let displayTitle = "";
        let textToSpeak = "";

        if (v.cantones) {
            const numPrefix = v.num ? `${v.num} - ` : "";
            const ptSuffix = v.portugues ? `<br><small style="font-weight:normal; opacity:0.8">${v.portugues}</small>` : "";
            displayTitle = `${numPrefix}${v.cantones}${ptSuffix}`;
            textToSpeak = v.cantones;
        } else {
            displayTitle = v.titulo;
            textToSpeak = limparTextoParaFala(v.titulo);
        }

        return `<div class="video-card" onclick="openPlayer('${faixaId}','${catKey}', ${index})">
            <strong>${displayTitle}</strong>
            <div class="audio-controls">
              <button class="btn-audio" onclick="event.stopPropagation(); falarBilingue('${v.cantones || ''}', '${v.portugues || ''}', '${catKey}', '${v.num || ''}')" title="Ouvir Pron√∫ncia e Tradu√ß√£o">
                 üîä
              </button>
            </div>
          </div>`;
    }).join("")}
      </div>
    </div>
  `;
}

// Player: Abre Modal (Overlay)
function openPlayer(faixaId, catKey, index) {
    currentPlaylist = catalogo[faixaId][catKey];
    currentIndex = index;
    updatePlayer();
    videoModal.classList.remove("hidden");
}

function updatePlayer() {
    const video = currentPlaylist[currentIndex];
    const modalTitleRaw = video.cantones
        ? `${video.num ? video.num + " - " : ""}${video.cantones} ${video.portugues ? " (" + video.portugues + ")" : ""}`
        : video.titulo;

    modalTitle.textContent = modalTitleRaw;
    videoIframe.src = `https://drive.google.com/file/d/${video.videoId}/preview`;

    // Visibilidade dos bot√µes
    prevBtn.style.visibility = currentIndex > 0 ? "visible" : "hidden";
    nextBtn.style.visibility = currentIndex < currentPlaylist.length - 1 ? "visible" : "hidden";
}

function changeVideo(delta) {
    const newIndex = currentIndex + delta;
    if (newIndex >= 0 && newIndex < currentPlaylist.length) {
        currentIndex = newIndex;
        updatePlayer();
    }
}

// Player: Fecha Modal
function closePlayer() {
    videoModal.classList.add("hidden");
    videoIframe.src = ""; // Para o v√≠deo
}

// --- L√≥gica de Pron√∫ncia (TTS) ---

function limparTextoParaFala(titulo) {
    // 1. Remove numera√ß√£o inicial (ex: "01 - ")
    let texto = titulo.replace(/^\d+\s*-\s*/, "");

    // 2. Remove conte√∫do entre par√™nteses e o pr√≥prio par√™nteses (ex: "(Frontal...)")
    texto = texto.replace(/\s*\(.*?\)/g, "");

    // 3. Remove tra√ßos extras que possam ter sobrado
    texto = texto.replace(/\s*-\s*/g, " ");

    return texto.trim();
}

function falarBilingue(cantones, portugues, catKey, num) {
    let ptText = portugues;

    // Se for categoria de b√°sicos e tiver n√∫mero, usa ordinal
    if ((catKey === 'basicos' || catKey === 'basicos_complementares') && num) {
        const ordinais = {
            "01": "Primeiro", "02": "Segundo", "03": "Terceiro", "04": "Quarto", "05": "Quinto",
            "06": "Sexto", "07": "S√©timo", "08": "Oitavo", "09": "Nono", "10": "D√©cimo"
        };
        const n = num.toString().padStart(2, '0');
        if (ordinais[n]) {
            ptText = `${ordinais[n]} B√°sico. ${portugues}`;
        }
    }

    if (cantones && ptText) {
        // Fala canton√™s primeiro, depois portugu√™s
        speak(cantones, "yue-HK", () => {
            setTimeout(() => speak(ptText, "pt-BR"), 500);
        });
    } else if (cantones) {
        speak(cantones, "yue-HK");
    } else if (ptText) {
        speak(ptText, "pt-BR");
    }
}

function falarCantonese(texto) {
    speak(texto, "yue-HK");
}

function speak(texto, langCode, onEndCallback) {
    if (!('speechSynthesis' in window)) return;

    const synth = window.speechSynthesis;

    // For√ßa o cancelamento de qualquer fala anterior
    synth.cancel();

    // Se as vozes ainda n√£o carregaram, as APIs as carregam de forma ass√≠ncrona
    if (synth.getVoices().length === 0) {
        synth.onvoiceschanged = () => speak(texto, langCode, onEndCallback);
        return;
    }

    const utterance = new SpeechSynthesisUtterance(texto);
    const voices = synth.getVoices();

    // L√≥gica robusta para encontrar a voz certa
    let voice = null;
    if (langCode === "yue-HK") {
        // Tenta encontrar Canton√™s (Hong Kong)
        voice = voices.find(v => v.lang === "yue-HK" || v.lang === "zh-HK" || v.lang.includes("Cantonese"));
        // Se n√£o achar, tenta qualquer chin√™s como fallback
        if (!voice) voice = voices.find(v => v.lang.startsWith("zh"));
    } else if (langCode === "pt-BR") {
        // Tenta encontrar Portugu√™s Brasil
        voice = voices.find(v => v.lang === "pt-BR" || v.lang === "pt_BR");
        // Se n√£o achar, tenta qualquer portugu√™s
        if (!voice) voice = voices.find(v => v.lang.startsWith("pt"));
    }

    if (voice) {
        utterance.voice = voice;
        utterance.lang = voice.lang;
    } else {
        utterance.lang = langCode;
    }

    utterance.rate = 0.9;
    if (onEndCallback) utterance.onend = onEndCallback;

    synth.speak(utterance);
}

// "Acorda" a API de vozes no carregamento da p√°gina
if ('speechSynthesis' in window) {
    window.speechSynthesis.getVoices();
}

// Inicia aplica√ß√£o
if (viewHome) init();

// L√≥gica do Tema
const themeBtn = document.getElementById("theme-btn");
const body = document.body;

// Carregar prefer√™ncia salva
const savedTheme = localStorage.getItem("theme");
if (savedTheme === "light") {
    body.classList.add("light-theme");
    themeBtn.textContent = "üåô Escuro";
}

function toggleTheme() {
    body.classList.toggle("light-theme");
    const isLight = body.classList.contains("light-theme");

    themeBtn.textContent = isLight ? "üåô Escuro" : "‚òÄÔ∏è Claro";
    localStorage.setItem("theme", isLight ? "light" : "dark");
}
